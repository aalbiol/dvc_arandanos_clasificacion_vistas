schema: '2.0'
stages:
  split_train_val:
    cmd: python ../src_clasificacion_vistas/data/MIL_split_train_val.py config/config2.yaml
    deps:
    - path: ../src_clasificacion_vistas/data/MIL_split_train_val.py
      hash: md5
      md5: b3be3970942d8e0999e7c50cf84801b7
      size: 2579
    params:
      config/config2.yaml:
        data:
          prob_train: 0.8
          crop_size:
          training_size:
          - 110
          - 110
          delimiter: _
          maxvalues: 255
          root_folder: data
          terminaciones:
          channel_list:
          - 0
          - 1
          - 2
          - 3
          train:
          - - train_list.txt
            - lote1/jsons
            - lote1/images
          - - train_list.txt
            - lote2/20230419_100534_BuenoEncoder/jsons
            - lote2/20230419_100534_BuenoEncoder/imags
          - - train_list.txt
            - lote2/20230419_112500_BuenoEncoder/jsons
            - lote2/20230419_112500_BuenoEncoder/imags
          - - train_list.txt
            - lote2/20230419_113002_LagrimaEncoder/jsons
            - lote2/20230419_113002_LagrimaEncoder/imags
          - - train_list.txt
            - lote2/20230419_114356_CicatrizDefSupEncoder/jsons
            - lote2/20230419_114356_CicatrizDefSupEncoder/imags
          - - train_list.txt
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/imags
          - - train_list.txt
            - lote2/20230419_115631_DestrioRotaEncoder/jsons
            - lote2/20230419_115631_DestrioRotaEncoder/imags
          - - train_list.txt
            - lote2/20230419_120236_DeformesDoblesEncoder/jsons
            - lote2/20230419_120236_DeformesDoblesEncoder/imags
          - - train_list.txt
            - lote2/20230419_122046ArrugadoEncoder/jsons
            - lote2/20230419_122046ArrugadoEncoder/imags
          - - train_list.txt
            - lote2/20230419_121536_BlandoEncoder/jsons
            - lote2/20230419_121536_BlandoEncoder/imags
          - - train_list.txt
            - lote2/20230419_122528_VerdeRojoEncoder/jsons
            - lote2/20230419_122528_VerdeRojoEncoder/imags
          val:
          - - val_list.txt
            - lote1/jsons
            - lote1/images
          - - val_list.txt
            - lote2/20230419_100534_BuenoEncoder/jsons
            - lote2/20230419_100534_BuenoEncoder/imags
          - - val_list.txt
            - lote2/20230419_112500_BuenoEncoder/jsons
            - lote2/20230419_112500_BuenoEncoder/imags
          - - val_list.txt
            - lote2/20230419_113002_LagrimaEncoder/jsons
            - lote2/20230419_113002_LagrimaEncoder/imags
          - - val_list.txt
            - lote2/20230419_114356_CicatrizDefSupEncoder/jsons
            - lote2/20230419_114356_CicatrizDefSupEncoder/imags
          - - val_list.txt
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/imags
          - - val_list.txt
            - lote2/20230419_115631_DestrioRotaEncoder/jsons
            - lote2/20230419_115631_DestrioRotaEncoder/imags
          - - val_list.txt
            - lote2/20230419_120236_DeformesDoblesEncoder/jsons
            - lote2/20230419_120236_DeformesDoblesEncoder/imags
          - - val_list.txt
            - lote2/20230419_122046ArrugadoEncoder/jsons
            - lote2/20230419_122046ArrugadoEncoder/imags
          - - val_list.txt
            - lote2/20230419_121536_BlandoEncoder/jsons
            - lote2/20230419_121536_BlandoEncoder/imags
          - - val_list.txt
            - lote2/20230419_122528_VerdeRojoEncoder/jsons
            - lote2/20230419_122528_VerdeRojoEncoder/imags
    outs:
    - path: data/lote1/jsons/train_list.txt
      hash: md5
      md5: 2710adbc5df902fffdd190d4d9cbe444
      size: 21128
    - path: data/lote1/jsons/val_list.txt
      hash: md5
      md5: a8525a04a3bd870fd3fbeff5a411ffb0
      size: 5331
    - path: data/lote2/20230419_100534_BuenoEncoder/jsons/train_list.txt
      hash: md5
      md5: 92adab23a3d13b22f4117bc13afd9734
      size: 30073
    - path: data/lote2/20230419_100534_BuenoEncoder/jsons/val_list.txt
      hash: md5
      md5: ccc24939fab64bcae29476a2c24db752
      size: 7564
    - path: data/lote2/20230419_112500_BuenoEncoder/jsons/train_list.txt
      hash: md5
      md5: 23d3a8d767093780737fc0e7c88eb4e9
      size: 18788
    - path: data/lote2/20230419_112500_BuenoEncoder/jsons/val_list.txt
      hash: md5
      md5: f5adbb0c5273c56b76dc632d05b8b219
      size: 4697
    - path: data/lote2/20230419_113002_LagrimaEncoder/jsons/train_list.txt
      hash: md5
      md5: 4de85d5c8ef00ea6f420454a778051dc
      size: 2268
    - path: data/lote2/20230419_113002_LagrimaEncoder/jsons/val_list.txt
      hash: md5
      md5: 60596bdc77a4b6d814986fd7403c214a
      size: 630
    - path: data/lote2/20230419_114356_CicatrizDefSupEncoder/jsons/train_list.txt
      hash: md5
      md5: 95909aaa605b8c701e828436f015f57c
      size: 15400
    - path: data/lote2/20230419_114356_CicatrizDefSupEncoder/jsons/val_list.txt
      hash: md5
      md5: c3f476ce79393fd9f21a44aa068d4dd2
      size: 3920
    - path: data/lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons/train_list.txt
      hash: md5
      md5: 2ab4ab42ad23d868560ad065663e5f14
      size: 20054
    - path: data/lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons/val_list.txt
      hash: md5
      md5: 1922ce82a0653a89c7d655b0094d897a
      size: 5032
    - path: data/lote2/20230419_115631_DestrioRotaEncoder/jsons/train_list.txt
      hash: md5
      md5: 926fa5ce1198ca337c486704b0f5ab51
      size: 1809
    - path: data/lote2/20230419_115631_DestrioRotaEncoder/jsons/val_list.txt
      hash: md5
      md5: 8d311172676f2f55d17bacfc8b186fee
      size: 469
    - path: data/lote2/20230419_120236_DeformesDoblesEncoder/jsons/train_list.txt
      hash: md5
      md5: b9ae8aeb21135b55b779732e87519b14
      size: 2100
    - path: data/lote2/20230419_120236_DeformesDoblesEncoder/jsons/val_list.txt
      hash: md5
      md5: 96956554398e563e5f5721369c9c4fb1
      size: 560
    - path: data/lote2/20230419_121536_BlandoEncoder/jsons/train_list.txt
      hash: md5
      md5: 1b8c5e8a21f4d1a6fb1c03297587972b
      size: 4588
    - path: data/lote2/20230419_121536_BlandoEncoder/jsons/val_list.txt
      hash: md5
      md5: 04189b84a585bb2f164253cbdaa15040
      size: 1178
    - path: data/lote2/20230419_122046ArrugadoEncoder/jsons/train_list.txt
      hash: md5
      md5: 6a64a063e3815c8904edbcd05ccd8a5c
      size: 6867
    - path: data/lote2/20230419_122046ArrugadoEncoder/jsons/val_list.txt
      hash: md5
      md5: bd8b378c215327831297021b37492356
      size: 1764
    - path: data/lote2/20230419_122528_VerdeRojoEncoder/jsons/train_list.txt
      hash: md5
      md5: eeb688cc0265dc5b8a2255c3dea690fc
      size: 1885
    - path: data/lote2/20230419_122528_VerdeRojoEncoder/jsons/val_list.txt
      hash: md5
      md5: d9cca64093816fd246643c4ce5e1b455
      size: 520
  train:
    cmd: python ../src_clasificacion_vistas/train/trainMIL.py --config config/config2.yaml
    deps:
    - path: ../src_clasificacion_vistas/train/trainMIL.py
      hash: md5
      md5: 9f6c579e72675a6bb660b3d9d63b2b20
      size: 5829
    params:
      config/config2.yaml:
        data:
          prob_train: 0.8
          crop_size:
          training_size:
          - 110
          - 110
          delimiter: _
          maxvalues: 255
          root_folder: data
          terminaciones:
          channel_list:
          - 0
          - 1
          - 2
          - 3
          train:
          - - train_list.txt
            - lote1/jsons
            - lote1/images
          - - train_list.txt
            - lote2/20230419_100534_BuenoEncoder/jsons
            - lote2/20230419_100534_BuenoEncoder/imags
          - - train_list.txt
            - lote2/20230419_112500_BuenoEncoder/jsons
            - lote2/20230419_112500_BuenoEncoder/imags
          - - train_list.txt
            - lote2/20230419_113002_LagrimaEncoder/jsons
            - lote2/20230419_113002_LagrimaEncoder/imags
          - - train_list.txt
            - lote2/20230419_114356_CicatrizDefSupEncoder/jsons
            - lote2/20230419_114356_CicatrizDefSupEncoder/imags
          - - train_list.txt
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/imags
          - - train_list.txt
            - lote2/20230419_115631_DestrioRotaEncoder/jsons
            - lote2/20230419_115631_DestrioRotaEncoder/imags
          - - train_list.txt
            - lote2/20230419_120236_DeformesDoblesEncoder/jsons
            - lote2/20230419_120236_DeformesDoblesEncoder/imags
          - - train_list.txt
            - lote2/20230419_122046ArrugadoEncoder/jsons
            - lote2/20230419_122046ArrugadoEncoder/imags
          - - train_list.txt
            - lote2/20230419_121536_BlandoEncoder/jsons
            - lote2/20230419_121536_BlandoEncoder/imags
          - - train_list.txt
            - lote2/20230419_122528_VerdeRojoEncoder/jsons
            - lote2/20230419_122528_VerdeRojoEncoder/imags
          val:
          - - val_list.txt
            - lote1/jsons
            - lote1/images
          - - val_list.txt
            - lote2/20230419_100534_BuenoEncoder/jsons
            - lote2/20230419_100534_BuenoEncoder/imags
          - - val_list.txt
            - lote2/20230419_112500_BuenoEncoder/jsons
            - lote2/20230419_112500_BuenoEncoder/imags
          - - val_list.txt
            - lote2/20230419_113002_LagrimaEncoder/jsons
            - lote2/20230419_113002_LagrimaEncoder/imags
          - - val_list.txt
            - lote2/20230419_114356_CicatrizDefSupEncoder/jsons
            - lote2/20230419_114356_CicatrizDefSupEncoder/imags
          - - val_list.txt
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/imags
          - - val_list.txt
            - lote2/20230419_115631_DestrioRotaEncoder/jsons
            - lote2/20230419_115631_DestrioRotaEncoder/imags
          - - val_list.txt
            - lote2/20230419_120236_DeformesDoblesEncoder/jsons
            - lote2/20230419_120236_DeformesDoblesEncoder/imags
          - - val_list.txt
            - lote2/20230419_122046ArrugadoEncoder/jsons
            - lote2/20230419_122046ArrugadoEncoder/imags
          - - val_list.txt
            - lote2/20230419_121536_BlandoEncoder/jsons
            - lote2/20230419_121536_BlandoEncoder/imags
          - - val_list.txt
            - lote2/20230419_122528_VerdeRojoEncoder/jsons
            - lote2/20230419_122528_VerdeRojoEncoder/imags
        model:
          defect_types:
          - Blandos
          - Cicatrices
          - defectos_severos
          - Deformes
          - Deshidratado
          - Flor_seca
          - Lagrima
          - Rabos
          - Rojos
          - Verdes
          num_channels_input: 4
          model_version: 50
        train:
          batch_size: 30
          epochs: 40
          in_memory: true
          initial_model:
          label_smoothing: 0.1
          learning_rate: 0.01
          optimizer: sgd
          num_workers: -1
          output:
            model_file: arandanos2.pkl
            path: out_models
          p_dropout: 0.5
          unfreeze_epoch: 6
          warmup: 3
          weights_decay: 0.001
          logname: prueba_dvc_mil_arandanos
          augmentation:
            random_rotation: 30
            brightness:
            - 0.8
            - 1.4
            contrast:
            - 0.8
            - 1.55
            hue: 0.01
            saturation: 0.15
            blur:
            - 0.1
            - 1.5
            affine:
              scale:
              - 0.7
              - 1.1
              shear: 15
              translate:
              - 0.15
              - 0.15
              degrees: 30
    outs:
    - path: out_models/arandanos2.pkl
      hash: md5
      md5: 5d7b690be163842ea7ad6f1a62ce2144
      size: 94445366
