schema: '2.0'
stages:
  split_train_val:
    cmd: python ../src_clasificacion_vistas/data/MIL_split_train_val.py config/config2.yaml
    deps:
    - path: ../src_clasificacion_vistas/data/MIL_split_train_val.py
      hash: md5
      md5: b3be3970942d8e0999e7c50cf84801b7
      size: 2579
    params:
      config/config2.yaml:
        data:
          prob_train: 0.8
          crop_size:
          training_size:
          - 110
          - 110
          maxvalues: 255
          root_folder: data
          terminaciones: .cimg
          channel_list:
          - 0
          - 1
          - 2
          - 3
          train:
          - - train_list.txt
            - lote1/jsons
            - lote1/images
          - - train_list.txt
            - lote2/20230419_100534_BuenoEncoder/jsons
            - lote2/20230419_100534_BuenoEncoder/imags
          - - train_list.txt
            - lote2/20230419_112500_BuenoEncoder/jsons
            - lote2/20230419_112500_BuenoEncoder/imags
          - - train_list.txt
            - lote2/20230419_113002_LagrimaEncoder/jsons
            - lote2/20230419_113002_LagrimaEncoder/imags
          - - train_list.txt
            - lote2/20230419_114356_CicatrizDefSupEncoder/jsons
            - lote2/20230419_114356_CicatrizDefSupEncoder/imags
          - - train_list.txt
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/imags
          - - train_list.txt
            - lote2/20230419_115631_DestrioRotaEncoder/jsons
            - lote2/20230419_115631_DestrioRotaEncoder/imags
          - - train_list.txt
            - lote2/20230419_120236_DeformesDoblesEncoder/jsons
            - lote2/20230419_120236_DeformesDoblesEncoder/imags
          - - train_list.txt
            - lote2/20230419_122046ArrugadoEncoder/jsons
            - lote2/20230419_122046ArrugadoEncoder/imags
          - - train_list.txt
            - lote2/20230419_121536_BlandoEncoder/jsons
            - lote2/20230419_121536_BlandoEncoder/imags
          - - train_list.txt
            - lote2/20230419_122528_VerdeRojoEncoder/jsons
            - lote2/20230419_122528_VerdeRojoEncoder/imags
          val:
          - - val_list.txt
            - lote1/jsons
            - lote1/images
          - - val_list.txt
            - lote2/20230419_100534_BuenoEncoder/jsons
            - lote2/20230419_100534_BuenoEncoder/imags
          - - val_list.txt
            - lote2/20230419_112500_BuenoEncoder/jsons
            - lote2/20230419_112500_BuenoEncoder/imags
          - - val_list.txt
            - lote2/20230419_113002_LagrimaEncoder/jsons
            - lote2/20230419_113002_LagrimaEncoder/imags
          - - val_list.txt
            - lote2/20230419_114356_CicatrizDefSupEncoder/jsons
            - lote2/20230419_114356_CicatrizDefSupEncoder/imags
          - - val_list.txt
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/imags
          - - val_list.txt
            - lote2/20230419_115631_DestrioRotaEncoder/jsons
            - lote2/20230419_115631_DestrioRotaEncoder/imags
          - - val_list.txt
            - lote2/20230419_120236_DeformesDoblesEncoder/jsons
            - lote2/20230419_120236_DeformesDoblesEncoder/imags
          - - val_list.txt
            - lote2/20230419_122046ArrugadoEncoder/jsons
            - lote2/20230419_122046ArrugadoEncoder/imags
          - - val_list.txt
            - lote2/20230419_121536_BlandoEncoder/jsons
            - lote2/20230419_121536_BlandoEncoder/imags
          - - val_list.txt
            - lote2/20230419_122528_VerdeRojoEncoder/jsons
            - lote2/20230419_122528_VerdeRojoEncoder/imags
    outs:
    - path: data/lote1/jsons/train_list.txt
      hash: md5
      md5: 04004dadef881b9b0cdd4c1200de8aaa
      size: 21114
    - path: data/lote1/jsons/val_list.txt
      hash: md5
      md5: b768ffcfecf38f5e2776a02ef567e10d
      size: 5345
    - path: data/lote2/20230419_100534_BuenoEncoder/jsons/train_list.txt
      hash: md5
      md5: 8bfd3dfd1e2e6cd5aed4e247012b71ff
      size: 30073
    - path: data/lote2/20230419_100534_BuenoEncoder/jsons/val_list.txt
      hash: md5
      md5: b07c1861d2d7f7ed65f5c1234a33327f
      size: 7564
    - path: data/lote2/20230419_112500_BuenoEncoder/jsons/train_list.txt
      hash: md5
      md5: b1581f2cc20267241c198e1aa6416dfd
      size: 18788
    - path: data/lote2/20230419_112500_BuenoEncoder/jsons/val_list.txt
      hash: md5
      md5: e335010077789dc2ad0f8fcb1b78e101
      size: 4697
    - path: data/lote2/20230419_113002_LagrimaEncoder/jsons/train_list.txt
      hash: md5
      md5: ec14ab32f5faa30e02ec360956f909f3
      size: 2268
    - path: data/lote2/20230419_113002_LagrimaEncoder/jsons/val_list.txt
      hash: md5
      md5: 63a3e798e5a406a58d4fdd6de66019f2
      size: 630
    - path: data/lote2/20230419_114356_CicatrizDefSupEncoder/jsons/train_list.txt
      hash: md5
      md5: 5f76413e2028a0f86304fca5c366e09e
      size: 15400
    - path: data/lote2/20230419_114356_CicatrizDefSupEncoder/jsons/val_list.txt
      hash: md5
      md5: 64933d0c488b4fde655fea0967b1a43b
      size: 3920
    - path: data/lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons/train_list.txt
      hash: md5
      md5: 8127f12b7a9cadd6d7f4ca02c1c2aa5f
      size: 20054
    - path: data/lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons/val_list.txt
      hash: md5
      md5: b480f3c67383b525569cfa4dc86b555e
      size: 5032
    - path: data/lote2/20230419_115631_DestrioRotaEncoder/jsons/train_list.txt
      hash: md5
      md5: 42643850a366a48cecedcc1258b94b7b
      size: 1809
    - path: data/lote2/20230419_115631_DestrioRotaEncoder/jsons/val_list.txt
      hash: md5
      md5: 6c715bd81db72cbba79712e8bfd41bca
      size: 469
    - path: data/lote2/20230419_120236_DeformesDoblesEncoder/jsons/train_list.txt
      hash: md5
      md5: a799de56e3caffdf8818ab1eca60adf7
      size: 2100
    - path: data/lote2/20230419_120236_DeformesDoblesEncoder/jsons/val_list.txt
      hash: md5
      md5: 67663e55cd074cc768c6ea3dfb3c2bea
      size: 560
    - path: data/lote2/20230419_121536_BlandoEncoder/jsons/train_list.txt
      hash: md5
      md5: d1a157b5d986f066875c820adaedc9f0
      size: 4588
    - path: data/lote2/20230419_121536_BlandoEncoder/jsons/val_list.txt
      hash: md5
      md5: 96cac8087ebece0e51f51ee7692e3fe4
      size: 1178
    - path: data/lote2/20230419_122046ArrugadoEncoder/jsons/train_list.txt
      hash: md5
      md5: 862bab92a08c4ab3924fc65b99d7a493
      size: 6867
    - path: data/lote2/20230419_122046ArrugadoEncoder/jsons/val_list.txt
      hash: md5
      md5: 96573f69a6bfcb90f87490a248261657
      size: 1764
    - path: data/lote2/20230419_122528_VerdeRojoEncoder/jsons/train_list.txt
      hash: md5
      md5: dcf98de831802f32575c6bda80f0d5c2
      size: 1885
    - path: data/lote2/20230419_122528_VerdeRojoEncoder/jsons/val_list.txt
      hash: md5
      md5: d59508f0fb8526eae6dc12008aa2404d
      size: 520
  train:
    cmd: python ../src_clasificacion_vistas/train/trainMIL.py --config config/config2.yaml
    deps:
    - path: ../src_clasificacion_vistas/train/trainMIL.py
      hash: md5
      md5: d8f999d84538ad684079f5324110354a
      size: 5909
    params:
      config/config2.yaml:
        data:
          prob_train: 0.8
          crop_size:
          training_size:
          - 110
          - 110
          maxvalues: 255
          root_folder: data
          terminaciones: .cimg
          channel_list:
          - 0
          - 1
          - 2
          - 3
          train:
          - - train_list.txt
            - lote1/jsons
            - lote1/images
          - - train_list.txt
            - lote2/20230419_100534_BuenoEncoder/jsons
            - lote2/20230419_100534_BuenoEncoder/imags
          - - train_list.txt
            - lote2/20230419_112500_BuenoEncoder/jsons
            - lote2/20230419_112500_BuenoEncoder/imags
          - - train_list.txt
            - lote2/20230419_113002_LagrimaEncoder/jsons
            - lote2/20230419_113002_LagrimaEncoder/imags
          - - train_list.txt
            - lote2/20230419_114356_CicatrizDefSupEncoder/jsons
            - lote2/20230419_114356_CicatrizDefSupEncoder/imags
          - - train_list.txt
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/imags
          - - train_list.txt
            - lote2/20230419_115631_DestrioRotaEncoder/jsons
            - lote2/20230419_115631_DestrioRotaEncoder/imags
          - - train_list.txt
            - lote2/20230419_120236_DeformesDoblesEncoder/jsons
            - lote2/20230419_120236_DeformesDoblesEncoder/imags
          - - train_list.txt
            - lote2/20230419_122046ArrugadoEncoder/jsons
            - lote2/20230419_122046ArrugadoEncoder/imags
          - - train_list.txt
            - lote2/20230419_121536_BlandoEncoder/jsons
            - lote2/20230419_121536_BlandoEncoder/imags
          - - train_list.txt
            - lote2/20230419_122528_VerdeRojoEncoder/jsons
            - lote2/20230419_122528_VerdeRojoEncoder/imags
          val:
          - - val_list.txt
            - lote1/jsons
            - lote1/images
          - - val_list.txt
            - lote2/20230419_100534_BuenoEncoder/jsons
            - lote2/20230419_100534_BuenoEncoder/imags
          - - val_list.txt
            - lote2/20230419_112500_BuenoEncoder/jsons
            - lote2/20230419_112500_BuenoEncoder/imags
          - - val_list.txt
            - lote2/20230419_113002_LagrimaEncoder/jsons
            - lote2/20230419_113002_LagrimaEncoder/imags
          - - val_list.txt
            - lote2/20230419_114356_CicatrizDefSupEncoder/jsons
            - lote2/20230419_114356_CicatrizDefSupEncoder/imags
          - - val_list.txt
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/imags
          - - val_list.txt
            - lote2/20230419_115631_DestrioRotaEncoder/jsons
            - lote2/20230419_115631_DestrioRotaEncoder/imags
          - - val_list.txt
            - lote2/20230419_120236_DeformesDoblesEncoder/jsons
            - lote2/20230419_120236_DeformesDoblesEncoder/imags
          - - val_list.txt
            - lote2/20230419_122046ArrugadoEncoder/jsons
            - lote2/20230419_122046ArrugadoEncoder/imags
          - - val_list.txt
            - lote2/20230419_121536_BlandoEncoder/jsons
            - lote2/20230419_121536_BlandoEncoder/imags
          - - val_list.txt
            - lote2/20230419_122528_VerdeRojoEncoder/jsons
            - lote2/20230419_122528_VerdeRojoEncoder/imags
        model:
          defect_types:
          - Blandos
          - Cicatrices
          - defectos_severos
          - Deformes
          - Deshidratado
          - Flor_seca
          - Lagrima
          - Rabos
          - Rojos
          - Verdes
          num_channels_input: 4
          model_version: 50
        train:
          batch_size: 30
          epochs: 40
          in_memory: true
          initial_model:
          label_smoothing: 0.1
          learning_rate: 0.01
          optimizer: sgd
          num_workers: -1
          output:
            model_file: arandanos2.pkl
            path: out_models
          p_dropout: 0.5
          unfreeze_epoch: 6
          warmup: 3
          weights_decay: 0.001
          logname: prueba_dvc_mil_arandanos
          augmentation:
            random_rotation: 30
            brightness:
            - 0.8
            - 1.4
            contrast:
            - 0.8
            - 1.55
            hue: 0.01
            saturation: 0.15
            blur:
            - 0.1
            - 1.5
            affine:
              scale:
              - 0.7
              - 1.1
              shear: 15
              translate:
              - 0.15
              - 0.15
              degrees: 30
    outs:
    - path: out_models/arandanos2.pkl
      hash: md5
      md5: 0ae8994eded7d3a5fcf9a6b2e84e2a52
      size: 94445312
  evaluate:
    cmd: python ../src_clasificacion_vistas/evaluate/evaluateMIL.py config/config2.yaml
    deps:
    - path: ../src_clasificacion_vistas/evaluate/evaluateMIL.py
      hash: md5
      md5: 44f76f37dac300cb62efc372d12ca94f
      size: 8865
    - path: out_models/arandanos2.pkl
      hash: md5
      md5: 0ae8994eded7d3a5fcf9a6b2e84e2a52
      size: 94445312
    params:
      config/config2.yaml:
        data:
          prob_train: 0.8
          crop_size:
          training_size:
          - 110
          - 110
          maxvalues: 255
          root_folder: data
          terminaciones: .cimg
          channel_list:
          - 0
          - 1
          - 2
          - 3
          train:
          - - train_list.txt
            - lote1/jsons
            - lote1/images
          - - train_list.txt
            - lote2/20230419_100534_BuenoEncoder/jsons
            - lote2/20230419_100534_BuenoEncoder/imags
          - - train_list.txt
            - lote2/20230419_112500_BuenoEncoder/jsons
            - lote2/20230419_112500_BuenoEncoder/imags
          - - train_list.txt
            - lote2/20230419_113002_LagrimaEncoder/jsons
            - lote2/20230419_113002_LagrimaEncoder/imags
          - - train_list.txt
            - lote2/20230419_114356_CicatrizDefSupEncoder/jsons
            - lote2/20230419_114356_CicatrizDefSupEncoder/imags
          - - train_list.txt
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/imags
          - - train_list.txt
            - lote2/20230419_115631_DestrioRotaEncoder/jsons
            - lote2/20230419_115631_DestrioRotaEncoder/imags
          - - train_list.txt
            - lote2/20230419_120236_DeformesDoblesEncoder/jsons
            - lote2/20230419_120236_DeformesDoblesEncoder/imags
          - - train_list.txt
            - lote2/20230419_122046ArrugadoEncoder/jsons
            - lote2/20230419_122046ArrugadoEncoder/imags
          - - train_list.txt
            - lote2/20230419_121536_BlandoEncoder/jsons
            - lote2/20230419_121536_BlandoEncoder/imags
          - - train_list.txt
            - lote2/20230419_122528_VerdeRojoEncoder/jsons
            - lote2/20230419_122528_VerdeRojoEncoder/imags
          val:
          - - val_list.txt
            - lote1/jsons
            - lote1/images
          - - val_list.txt
            - lote2/20230419_100534_BuenoEncoder/jsons
            - lote2/20230419_100534_BuenoEncoder/imags
          - - val_list.txt
            - lote2/20230419_112500_BuenoEncoder/jsons
            - lote2/20230419_112500_BuenoEncoder/imags
          - - val_list.txt
            - lote2/20230419_113002_LagrimaEncoder/jsons
            - lote2/20230419_113002_LagrimaEncoder/imags
          - - val_list.txt
            - lote2/20230419_114356_CicatrizDefSupEncoder/jsons
            - lote2/20230419_114356_CicatrizDefSupEncoder/imags
          - - val_list.txt
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/imags
          - - val_list.txt
            - lote2/20230419_115631_DestrioRotaEncoder/jsons
            - lote2/20230419_115631_DestrioRotaEncoder/imags
          - - val_list.txt
            - lote2/20230419_120236_DeformesDoblesEncoder/jsons
            - lote2/20230419_120236_DeformesDoblesEncoder/imags
          - - val_list.txt
            - lote2/20230419_122046ArrugadoEncoder/jsons
            - lote2/20230419_122046ArrugadoEncoder/imags
          - - val_list.txt
            - lote2/20230419_121536_BlandoEncoder/jsons
            - lote2/20230419_121536_BlandoEncoder/imags
          - - val_list.txt
            - lote2/20230419_122528_VerdeRojoEncoder/jsons
            - lote2/20230419_122528_VerdeRojoEncoder/imags
        evaluate:
          model_dir: out_models
          model_file: arandanos2.pkl
          report_dir: out_evaluate
          train_predictions: train_scores.json
          val_predictions: val_scores.json
          aucs: aucs.json
        model:
          defect_types:
          - Blandos
          - Cicatrices
          - defectos_severos
          - Deformes
          - Deshidratado
          - Flor_seca
          - Lagrima
          - Rabos
          - Rojos
          - Verdes
          num_channels_input: 4
          model_version: 50
    outs:
    - path: out_evaluate/aucs.json
      hash: md5
      md5: 9d00a11b37fc1b707be57287b7262bda
      size: 965
    - path: out_evaluate/train_scores.json
      hash: md5
      md5: 31738ac6df3c2211a6406fbf8da1e1c8
      size: 1556017
    - path: out_evaluate/val_scores.json
      hash: md5
      md5: 87246ee9bb79ce2d8a91ee2ead6244cf
      size: 394623
  report:
    cmd: jupyter nbconvert --to notebook --execute reports/analisis_prestaciones.ipynb
    deps:
    - path: out_evaluate/aucs.json
      hash: md5
      md5: 9d00a11b37fc1b707be57287b7262bda
      size: 965
    - path: out_evaluate/train_scores.json
      hash: md5
      md5: 31738ac6df3c2211a6406fbf8da1e1c8
      size: 1556017
    - path: out_evaluate/val_scores.json
      hash: md5
      md5: 87246ee9bb79ce2d8a91ee2ead6244cf
      size: 394623
    - path: reports/analisis_prestaciones.ipynb
      hash: md5
      md5: 76805fc98bc0d460e9313ff8a10b5a35
      size: 325958
    outs:
    - path: reports/analisis_prestaciones.nbconvert.ipynb
      hash: md5
      md5: 2ece886b8f7cfc41f5b5c8daa71e07bc
      size: 309145
