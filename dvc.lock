schema: '2.0'
stages:
  split_train_val:
    cmd: python ../src_clasificacion_vistas/data/MIL_split_train_val.py config/config2.yaml
    deps:
    - path: ../src_clasificacion_vistas/data/MIL_split_train_val.py
      hash: md5
      md5: b3be3970942d8e0999e7c50cf84801b7
      size: 2579
    params:
      config/config2.yaml:
        data:
          prob_train: 0.8
          crop_size:
          training_size:
          - 110
          - 110
          maxvalues: 255
          root_folder: data
          terminaciones:
          channel_list:
          - 0
          - 1
          - 2
          - 3
          train:
          - - train_list.txt
            - lote1/jsons
            - lote1/images
          - - train_list.txt
            - lote2/20230419_100534_BuenoEncoder/jsons
            - lote2/20230419_100534_BuenoEncoder/imags
          - - train_list.txt
            - lote2/20230419_112500_BuenoEncoder/jsons
            - lote2/20230419_112500_BuenoEncoder/imags
          - - train_list.txt
            - lote2/20230419_113002_LagrimaEncoder/jsons
            - lote2/20230419_113002_LagrimaEncoder/imags
          - - train_list.txt
            - lote2/20230419_114356_CicatrizDefSupEncoder/jsons
            - lote2/20230419_114356_CicatrizDefSupEncoder/imags
          - - train_list.txt
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/imags
          - - train_list.txt
            - lote2/20230419_115631_DestrioRotaEncoder/jsons
            - lote2/20230419_115631_DestrioRotaEncoder/imags
          - - train_list.txt
            - lote2/20230419_120236_DeformesDoblesEncoder/jsons
            - lote2/20230419_120236_DeformesDoblesEncoder/imags
          - - train_list.txt
            - lote2/20230419_122046ArrugadoEncoder/jsons
            - lote2/20230419_122046ArrugadoEncoder/imags
          - - train_list.txt
            - lote2/20230419_121536_BlandoEncoder/jsons
            - lote2/20230419_121536_BlandoEncoder/imags
          - - train_list.txt
            - lote2/20230419_122528_VerdeRojoEncoder/jsons
            - lote2/20230419_122528_VerdeRojoEncoder/imags
          val:
          - - val_list.txt
            - lote1/jsons
            - lote1/images
          - - val_list.txt
            - lote2/20230419_100534_BuenoEncoder/jsons
            - lote2/20230419_100534_BuenoEncoder/imags
          - - val_list.txt
            - lote2/20230419_112500_BuenoEncoder/jsons
            - lote2/20230419_112500_BuenoEncoder/imags
          - - val_list.txt
            - lote2/20230419_113002_LagrimaEncoder/jsons
            - lote2/20230419_113002_LagrimaEncoder/imags
          - - val_list.txt
            - lote2/20230419_114356_CicatrizDefSupEncoder/jsons
            - lote2/20230419_114356_CicatrizDefSupEncoder/imags
          - - val_list.txt
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/imags
          - - val_list.txt
            - lote2/20230419_115631_DestrioRotaEncoder/jsons
            - lote2/20230419_115631_DestrioRotaEncoder/imags
          - - val_list.txt
            - lote2/20230419_120236_DeformesDoblesEncoder/jsons
            - lote2/20230419_120236_DeformesDoblesEncoder/imags
          - - val_list.txt
            - lote2/20230419_122046ArrugadoEncoder/jsons
            - lote2/20230419_122046ArrugadoEncoder/imags
          - - val_list.txt
            - lote2/20230419_121536_BlandoEncoder/jsons
            - lote2/20230419_121536_BlandoEncoder/imags
          - - val_list.txt
            - lote2/20230419_122528_VerdeRojoEncoder/jsons
            - lote2/20230419_122528_VerdeRojoEncoder/imags
    outs:
    - path: data/lote1/jsons/train_list.txt
      hash: md5
      md5: 6d32bcfb8cab12b328950fe71c4fa123
      size: 21117
    - path: data/lote1/jsons/val_list.txt
      hash: md5
      md5: 3e8afa0aa97f57bf0e31790d3c86a6c4
      size: 5342
    - path: data/lote2/20230419_100534_BuenoEncoder/jsons/train_list.txt
      hash: md5
      md5: 5d6b89c8ac7779138ce660ad6fd29c53
      size: 30073
    - path: data/lote2/20230419_100534_BuenoEncoder/jsons/val_list.txt
      hash: md5
      md5: 6f113cb8c98dbc68570d14bb68284881
      size: 7564
    - path: data/lote2/20230419_112500_BuenoEncoder/jsons/train_list.txt
      hash: md5
      md5: 346447ec9d8ff94a5a347ecfa4dc4e79
      size: 18788
    - path: data/lote2/20230419_112500_BuenoEncoder/jsons/val_list.txt
      hash: md5
      md5: 482e8e81d950a643dcb280eb2397c287
      size: 4697
    - path: data/lote2/20230419_113002_LagrimaEncoder/jsons/train_list.txt
      hash: md5
      md5: 1d0ab30a579b362fe52a9026311c82b7
      size: 2268
    - path: data/lote2/20230419_113002_LagrimaEncoder/jsons/val_list.txt
      hash: md5
      md5: 2ff77b3e68efe0dc635b17ad546cc8f0
      size: 630
    - path: data/lote2/20230419_114356_CicatrizDefSupEncoder/jsons/train_list.txt
      hash: md5
      md5: c1ec11200d1f9cb2be7246efe3f00f04
      size: 15400
    - path: data/lote2/20230419_114356_CicatrizDefSupEncoder/jsons/val_list.txt
      hash: md5
      md5: 551e451dbc97a5b83821f755d518af8e
      size: 3920
    - path: data/lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons/train_list.txt
      hash: md5
      md5: 9ae912216f4a4e83786b99fd038229be
      size: 20054
    - path: data/lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons/val_list.txt
      hash: md5
      md5: d11f8b9762a50c553a9035c635cca48e
      size: 5032
    - path: data/lote2/20230419_115631_DestrioRotaEncoder/jsons/train_list.txt
      hash: md5
      md5: 5e99b7dee3f11fb3f9dec2ada117bac9
      size: 1809
    - path: data/lote2/20230419_115631_DestrioRotaEncoder/jsons/val_list.txt
      hash: md5
      md5: e1ff371d32cdeac6eed6ac47f2da4137
      size: 469
    - path: data/lote2/20230419_120236_DeformesDoblesEncoder/jsons/train_list.txt
      hash: md5
      md5: 345659414263936ef0ccaae0e041782c
      size: 2100
    - path: data/lote2/20230419_120236_DeformesDoblesEncoder/jsons/val_list.txt
      hash: md5
      md5: c0564e68dbbada96c09d3436d0c82b92
      size: 560
    - path: data/lote2/20230419_121536_BlandoEncoder/jsons/train_list.txt
      hash: md5
      md5: 73ba65b77afb81970bd10721dfe16a5c
      size: 4588
    - path: data/lote2/20230419_121536_BlandoEncoder/jsons/val_list.txt
      hash: md5
      md5: a50d00151c10409f2069859f563bc10f
      size: 1178
    - path: data/lote2/20230419_122046ArrugadoEncoder/jsons/train_list.txt
      hash: md5
      md5: fc3aadeb7bab5f84f54fb29c0701bbef
      size: 6867
    - path: data/lote2/20230419_122046ArrugadoEncoder/jsons/val_list.txt
      hash: md5
      md5: 43a64b9e8186c9c8fb2d1c791f01bf69
      size: 1764
    - path: data/lote2/20230419_122528_VerdeRojoEncoder/jsons/train_list.txt
      hash: md5
      md5: 470860e6031809c9f137599ad7dad23d
      size: 1885
    - path: data/lote2/20230419_122528_VerdeRojoEncoder/jsons/val_list.txt
      hash: md5
      md5: f993ad880e09f2b1130768e6b4b63772
      size: 520
  train:
    cmd: python ../src_clasificacion_vistas/train/trainMIL.py --config config/config2.yaml
    deps:
    - path: ../src_clasificacion_vistas/train/trainMIL.py
      hash: md5
      md5: 93446354f7bcbdc05b54e2667346c4c1
      size: 5792
    params:
      config/config2.yaml:
        data:
          prob_train: 0.8
          crop_size:
          training_size:
          - 110
          - 110
          maxvalues: 255
          root_folder: data
          terminaciones:
          channel_list:
          - 0
          - 1
          - 2
          - 3
          train:
          - - train_list.txt
            - lote1/jsons
            - lote1/images
          - - train_list.txt
            - lote2/20230419_100534_BuenoEncoder/jsons
            - lote2/20230419_100534_BuenoEncoder/imags
          - - train_list.txt
            - lote2/20230419_112500_BuenoEncoder/jsons
            - lote2/20230419_112500_BuenoEncoder/imags
          - - train_list.txt
            - lote2/20230419_113002_LagrimaEncoder/jsons
            - lote2/20230419_113002_LagrimaEncoder/imags
          - - train_list.txt
            - lote2/20230419_114356_CicatrizDefSupEncoder/jsons
            - lote2/20230419_114356_CicatrizDefSupEncoder/imags
          - - train_list.txt
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/imags
          - - train_list.txt
            - lote2/20230419_115631_DestrioRotaEncoder/jsons
            - lote2/20230419_115631_DestrioRotaEncoder/imags
          - - train_list.txt
            - lote2/20230419_120236_DeformesDoblesEncoder/jsons
            - lote2/20230419_120236_DeformesDoblesEncoder/imags
          - - train_list.txt
            - lote2/20230419_122046ArrugadoEncoder/jsons
            - lote2/20230419_122046ArrugadoEncoder/imags
          - - train_list.txt
            - lote2/20230419_121536_BlandoEncoder/jsons
            - lote2/20230419_121536_BlandoEncoder/imags
          - - train_list.txt
            - lote2/20230419_122528_VerdeRojoEncoder/jsons
            - lote2/20230419_122528_VerdeRojoEncoder/imags
          val:
          - - val_list.txt
            - lote1/jsons
            - lote1/images
          - - val_list.txt
            - lote2/20230419_100534_BuenoEncoder/jsons
            - lote2/20230419_100534_BuenoEncoder/imags
          - - val_list.txt
            - lote2/20230419_112500_BuenoEncoder/jsons
            - lote2/20230419_112500_BuenoEncoder/imags
          - - val_list.txt
            - lote2/20230419_113002_LagrimaEncoder/jsons
            - lote2/20230419_113002_LagrimaEncoder/imags
          - - val_list.txt
            - lote2/20230419_114356_CicatrizDefSupEncoder/jsons
            - lote2/20230419_114356_CicatrizDefSupEncoder/imags
          - - val_list.txt
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/imags
          - - val_list.txt
            - lote2/20230419_115631_DestrioRotaEncoder/jsons
            - lote2/20230419_115631_DestrioRotaEncoder/imags
          - - val_list.txt
            - lote2/20230419_120236_DeformesDoblesEncoder/jsons
            - lote2/20230419_120236_DeformesDoblesEncoder/imags
          - - val_list.txt
            - lote2/20230419_122046ArrugadoEncoder/jsons
            - lote2/20230419_122046ArrugadoEncoder/imags
          - - val_list.txt
            - lote2/20230419_121536_BlandoEncoder/jsons
            - lote2/20230419_121536_BlandoEncoder/imags
          - - val_list.txt
            - lote2/20230419_122528_VerdeRojoEncoder/jsons
            - lote2/20230419_122528_VerdeRojoEncoder/imags
        model:
          defect_types:
          - Blandos
          - Cicatrices
          - defectos_severos
          - Deformes
          - Deshidratado
          - Flor_seca
          - Lagrima
          - Rabos
          - Rojos
          - Verdes
          num_channels_input: 4
          model_version: 50
        train:
          batch_size: 30
          epochs: 40
          in_memory: true
          initial_model:
          label_smoothing: 0.1
          learning_rate: 0.01
          optimizer: sgd
          num_workers: -1
          output:
            model_file: arandanos2.pkl
            path: out_models
          p_dropout: 0.5
          unfreeze_epoch: 6
          warmup: 3
          weights_decay: 0.001
          logname: prueba_dvc_mil_arandanos
          augmentation:
            random_rotation: 30
            brightness:
            - 0.8
            - 1.4
            contrast:
            - 0.8
            - 1.55
            hue: 0.01
            saturation: 0.15
            blur:
            - 0.1
            - 1.5
            affine:
              scale:
              - 0.7
              - 1.1
              shear: 15
              translate:
              - 0.15
              - 0.15
              degrees: 30
    outs:
    - path: out_models/arandanos2.pkl
      hash: md5
      md5: 520573f342011dff3db2a4b25d32b199
      size: 94445305
  evaluate:
    cmd: python ../src_clasificacion_vistas/evaluate/evaluateMIL.py config/config2.yaml
    deps:
    - path: ../src_clasificacion_vistas/evaluate/evaluateMIL.py
      hash: md5
      md5: 44f76f37dac300cb62efc372d12ca94f
      size: 8865
    - path: out_models/arandanos2.pkl
      hash: md5
      md5: 520573f342011dff3db2a4b25d32b199
      size: 94445305
    params:
      config/config2.yaml:
        data:
          prob_train: 0.8
          crop_size:
          training_size:
          - 110
          - 110
          maxvalues: 255
          root_folder: data
          terminaciones:
          channel_list:
          - 0
          - 1
          - 2
          - 3
          train:
          - - train_list.txt
            - lote1/jsons
            - lote1/images
          - - train_list.txt
            - lote2/20230419_100534_BuenoEncoder/jsons
            - lote2/20230419_100534_BuenoEncoder/imags
          - - train_list.txt
            - lote2/20230419_112500_BuenoEncoder/jsons
            - lote2/20230419_112500_BuenoEncoder/imags
          - - train_list.txt
            - lote2/20230419_113002_LagrimaEncoder/jsons
            - lote2/20230419_113002_LagrimaEncoder/imags
          - - train_list.txt
            - lote2/20230419_114356_CicatrizDefSupEncoder/jsons
            - lote2/20230419_114356_CicatrizDefSupEncoder/imags
          - - train_list.txt
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/imags
          - - train_list.txt
            - lote2/20230419_115631_DestrioRotaEncoder/jsons
            - lote2/20230419_115631_DestrioRotaEncoder/imags
          - - train_list.txt
            - lote2/20230419_120236_DeformesDoblesEncoder/jsons
            - lote2/20230419_120236_DeformesDoblesEncoder/imags
          - - train_list.txt
            - lote2/20230419_122046ArrugadoEncoder/jsons
            - lote2/20230419_122046ArrugadoEncoder/imags
          - - train_list.txt
            - lote2/20230419_121536_BlandoEncoder/jsons
            - lote2/20230419_121536_BlandoEncoder/imags
          - - train_list.txt
            - lote2/20230419_122528_VerdeRojoEncoder/jsons
            - lote2/20230419_122528_VerdeRojoEncoder/imags
          val:
          - - val_list.txt
            - lote1/jsons
            - lote1/images
          - - val_list.txt
            - lote2/20230419_100534_BuenoEncoder/jsons
            - lote2/20230419_100534_BuenoEncoder/imags
          - - val_list.txt
            - lote2/20230419_112500_BuenoEncoder/jsons
            - lote2/20230419_112500_BuenoEncoder/imags
          - - val_list.txt
            - lote2/20230419_113002_LagrimaEncoder/jsons
            - lote2/20230419_113002_LagrimaEncoder/imags
          - - val_list.txt
            - lote2/20230419_114356_CicatrizDefSupEncoder/jsons
            - lote2/20230419_114356_CicatrizDefSupEncoder/imags
          - - val_list.txt
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/jsons
            - lote2/20230419_115102_HojaRaboConDeformeEncoder/imags
          - - val_list.txt
            - lote2/20230419_115631_DestrioRotaEncoder/jsons
            - lote2/20230419_115631_DestrioRotaEncoder/imags
          - - val_list.txt
            - lote2/20230419_120236_DeformesDoblesEncoder/jsons
            - lote2/20230419_120236_DeformesDoblesEncoder/imags
          - - val_list.txt
            - lote2/20230419_122046ArrugadoEncoder/jsons
            - lote2/20230419_122046ArrugadoEncoder/imags
          - - val_list.txt
            - lote2/20230419_121536_BlandoEncoder/jsons
            - lote2/20230419_121536_BlandoEncoder/imags
          - - val_list.txt
            - lote2/20230419_122528_VerdeRojoEncoder/jsons
            - lote2/20230419_122528_VerdeRojoEncoder/imags
        evaluate:
          model_dir: out_models
          model_file: arandanos2.pkl
          report_dir: out_evaluate
          train_predictions: train_scores.json
          val_predictions: val_scores.json
          aucs: aucs.json
        model:
          defect_types:
          - Blandos
          - Cicatrices
          - defectos_severos
          - Deformes
          - Deshidratado
          - Flor_seca
          - Lagrima
          - Rabos
          - Rojos
          - Verdes
          num_channels_input: 4
          model_version: 50
    outs:
    - path: out_evaluate/aucs.json
      hash: md5
      md5: 8d1a3fd52e57fc10273507c2c9d8032f
      size: 964
    - path: out_evaluate/train_scores.json
      hash: md5
      md5: 3e3f6a63d3975dc4fe30c6041d28e468
      size: 1556048
    - path: out_evaluate/val_scores.json
      hash: md5
      md5: a9a1cafc21ff05330d5bab0f837b8354
      size: 394605
  report:
    cmd: jupyter nbconvert --to notebook --execute reports/analisis_prestaciones.ipynb
    deps:
    - path: out_evaluate/aucs.json
      hash: md5
      md5: 8d1a3fd52e57fc10273507c2c9d8032f
      size: 964
    - path: out_evaluate/train_scores.json
      hash: md5
      md5: 3e3f6a63d3975dc4fe30c6041d28e468
      size: 1556048
    - path: out_evaluate/val_scores.json
      hash: md5
      md5: a9a1cafc21ff05330d5bab0f837b8354
      size: 394605
    - path: reports/analisis_prestaciones.ipynb
      hash: md5
      md5: 76805fc98bc0d460e9313ff8a10b5a35
      size: 325958
    outs:
    - path: reports/analisis_prestaciones.nbconvert.ipynb
      hash: md5
      md5: aa6a60121a2bb4d6ae2ab596ef44af65
      size: 314165
